<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Video QA Demo</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="page">

    <h1 class="title">ğŸ¥ Video QA Demo</h1>

    <div class="container">

        <!-- å·¦ä¾§ï¼šè¾“å…¥åŒº -->
        <div class="left-panel">
            <div class="card">
                <div class="card-details">
                    <form method="post" enctype="multipart/form-data">

                        <label class="label">ä¸Šä¼ è§†é¢‘</label>
                        <input type="file" name="video" required>

                        <label class="label">é—®é¢˜</label>
                        <div class="search">
                            <input
                                type="text"
                                id="question-input"
                                name="question"
                                class="search__input"
                                placeholder="è¯·è¾“å…¥é—®é¢˜"
                                value="{{ question }}"
                            >
                        </div>

                        <label class="label">å¸¸è§é—®é¢˜</label>
                        <select class="select" onchange="setQuestion(this.value)">
                            <option value="">é€‰æ‹©ä¸€ä¸ªé—®é¢˜</option>
                            {% for q in common_questions %}
                                <option value="{{ q }}">{{ q }}</option>
                            {% endfor %}
                        </select>

                        <button type="submit" class="btn-shine">
                            <span>æäº¤</span>
                        </button>

                    </form>
                </div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šå›ç­” + å†å²è®°å½• -->
        <div class="right-panel">

            <!-- å›ç­”å¡ç‰‡ -->
            <div class="card">
                <div class="card-details">
                    <p class="text-title">å›ç­”</p>
                    <p class="text-body">
                        {{ answer if answer else "ç­‰å¾…æé—®â€¦" }}
                    </p>

                </div>
            </div>

            <!-- â˜… æ–°å¢ï¼šå†å²è®°å½•å¡ç‰‡ -->
            <div class="card history-card">
                <div class="history-header" onclick="toggleHistory()">
                    <span>å†å²è®°å½• â–¼</span>
                </div>
                <div id="history-list" class="history-list" style="display:none;">
                    <!-- JS åŠ¨æ€æ’å…¥å†å²è®°å½• -->
                </div>
            </div>

        </div>
    </div>
</div>

<!-- JS -->
<script>
let historyVisible = false;

function setQuestion(text) {
    if (text) {
        document.getElementById("question-input").value = text;
    }
}

function toggleHistory() {
    const list = document.getElementById("history-list");
    historyVisible = !historyVisible;
    list.style.display = historyVisible ? "block" : "none";
}

// åŠ è½½å†å²è®°å½•
function loadHistory() {
    fetch("/history")
        .then(res => res.json())
        .then(data => {
            const list = document.getElementById("history-list");
            list.innerHTML = "";

            data.forEach(item => {
                const div = document.createElement("div");
                div.className = "history-item";

                div.innerHTML = `
                    <div class="history-row">
                        <div class="history-content">
                            <div class="q">Q: ${item.question}</div>
                            <div class="a">A: ${item.answer}</div>
                            <div class="video-path"><strong>è·¯å¾„:</strong> ${item.video_path}</div>
                        </div>
                        <div class="history-actions">
                            <button onclick="deleteHistory(${item.id})">åˆ é™¤</button>
                        </div>
                    </div>
                `;

                list.appendChild(div);
            });
        });
}

function deleteHistory(id) {
    fetch(`/history/${id}`, { method: "DELETE" })
        .then(() => loadHistory());
}

// é¡µé¢åŠ è½½æ—¶åˆ·æ–°å†å²è®°å½•
loadHistory();
</script>

</body>
</html>
